# TIL - 2026年02月12日

## 今日のメモ
# 📅 開発日誌 (2026-02-12)

## 🚀 プロジェクト概要: aruaruarena (AI共感型投稿プラットフォーム)
- **役割**: バックエンドエンジニア (Ruby on Rails / AWS Lambda)
- **タスク**: E06-05 JudgePostServiceの実装（並列処理・スコア集計）

---

### 📷 本日のハイライト（スクリーンショット）
![ここにテスト成功のコンソール画面やCodeRabbitのレビュー完了画面などを貼る]

---

## 💡 技術的達成・解決した課題

### 1. テスト環境におけるブロッキング問題の特定と解決
RSpec実行時に `DynamoDB Local` への接続がハングアップする重大な問題が発生。以下の手順で原因を特定し、解決しました。

- **現象**: `JudgePostService` のテスト実行中にプロセスがフリーズし、タイムアウトも発生しない。
- **調査アプローチ**:
  - `reproduce_issue.rb` という最小再現スクリプトを作成し、`aws-sdk` と `Net::HTTP` で挙動を比較。
  - `curl` コマンドによる低レイヤーでの検証を行い、特定ポート(8000)のコンテナが認証ヘッダー付リクエストでフリーズすることを特定。
- **解決策**:
  - テスト環境の向け先を、永続化用のポート8000から、インメモリ用のポート8002のコンテナに切り替え。
  - これによりテストの安定性と実行速度（インメモリ化による高速化）の両方を達成。

### 2. TDD（テスト駆動開発）による堅牢なサービス実装
「Red → Green → Refactor」のサイクルを厳密に回し、並列処理を含む複雑なビジネスロジックを実装しました。

- **Red**: 未実装の `DewiAdapter` や `JudgePostService` に対する失敗するテストを定義（要件の明確化）。
- **Green**: `Thread` を用いた非同期並列処理（3つのAIモデルへの同時リクエスト）を最小限のコードで実装。
- **Refactor**: 
  - 変数名の競合（Shadowing）を解消し、可読性を向上。
  - 特異クラスメソッド `handle_error` の責務を整理し、エラーハンドリングを統一。

### 3. アーキテクチャ選定の再評価（Rails API vs Next.js）
プロジェクトの技術スタック（Vite + Rails API on Lambda）の正当性を再確認し、ドキュメント化しました。

- **コスト最適化**: フロントエンドをS3+CloudFrontで配信し、ランニングコストをAWS全体で約$0.26/月に抑制。
- **責務の分離**: 複雑なAIオーケストレーションは堅牢なRailsバックエンドに、リッチなUI（Framer Motion）はReact SPAに集中。
- **Next.js非採用の理由**: SSR不要な動的OGP生成戦略（バックエンド主導のキャッシュウォーミング）を採用しているため、オーバースペックによる複雑化を回避。

---

## 🛠️ 作業ログ (Git Commits)

```text
e19b41a fix: E06-05 JudgeErrorクラスの変数名競合解消 #34 (Yadon987)
ff3dd90 fix: E06-05 CodeRabbitレビュー指摘事項に対応 #34 (Yadon987)
d273fd0 docs: JudgeErrorのドキュメントを修正 #34 (Yadon987)
703a2af refactor: E06-05 リファクタリングプランを実装 #34 (Yadon987)
c1be03d docs: E06-05_REFACTOR_PLANのドキュメント誤りを修正 #34 (Yadon987)
62a6ead fix: E06-05 CodeRabbitレビューの指摘事項を修正 #34 (Yadon987)
7759365 feat: E06-05 GREENテストがパスする最小限の実装 #34 (Yadon987)
5276bdd test: E06-05 REDテストを実装 #34 (Yadon987)

## 気分・状態
今日の気分: 😁 (5: とても気分が良い)
今日のモチベーション: 🌈 (5: とてもやる気がある)
目標の進捗: 🌳 (5: とてもよく進んだ)

---
*Generated by ちいくさ日記*  
*Date: 2026-02-12*  
*Created: 2026-02-12 23:23:40*
