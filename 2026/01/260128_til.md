# TIL - 2026年01月28日

## 今日のメモ
勉強時間：10時間

さすがに1日中カリキュラムを進めると頭が回らずに寝てしまう…なにか勉強方法を変えないと効率が悪すぎてちょっとまずい
応用STEP　進捗率76％

# 🚀 開発日誌 (2026-01-28) - オブジェクト指向設計の実践：自動販売機のリファクタリング
## 📝 概要
本日は、既存の自動販売機アプリケーション（Ruby）に対し、オブジェクト指向設計原則に基づいた大規模なリファクタリングを実施しました。
「動くコード」から「変更に強く、読みやすいコード」への昇華を目的とし、特に**プリミティブ型執着の解消**と**ファーストクラスコレクションの導入**に注力しました。
## 📸 スクリーンショット / デモ
<!-- ここに機能の動作画面や、Before/Afterのコード差分（Diff）のキャプチャを貼ってください -->
(ここに画像をドロップ)
## 🛠 技術的な取り組みと設計判断
### 1. プリミティブ型執着からの脱却 (Value Objectの導入)
**【課題】**
以前は在庫数や金額を単なる `Integer` で管理しており、どこからでも不正な計算（例: 在庫のマイナス化）が可能で、ロジックが分散していました。
**【解決策】**
`Stock` クラスや `Coin` クラスを導入し、数値に「意味」と「振る舞い」を与えました。
- **効果:** 在庫の減算ロジック `decrement` をメソッド化することで、不正な操作を防ぎ、不変条件（在庫は0以上など）を強制できるようになりました。
### 2. 配列操作の隠蔽 (First Class Collectionの導入)
**【課題】**
`VendingMachine` クラスが、お釣りの計算や硬貨配列の管理といった細かな責務まで抱え込み、肥大化していました（God Class化の兆候）。
**【解決策】**
`StockOf100Yen` や `Change` といったファーストクラスコレクションを実装し、配列操作を専用クラスに委譲しました。
- **効果:** 複雑だった返金ロジック（`refund`）が、内部実装を隠蔽したことでわずか3行のシンプルなメソッドになりました。
### 3. TDD（テスト駆動開発）の実践
リファクタリングに際し、「常にテストが通る状態」を維持することを徹底しました。
- Docker環境でのテスト自動化を行い、変更のたびにバイタルチェックを実施。
- テストコード自体もリファクタリングし、仕様書としての可読性を高めました。
## 💻 コードのビフォーアフター
### Before: 責務過多な返金ロジック
数値計算と配列操作が混ざり合い、可読性が低い状態でした。
```ruby
# 複雑な計算ロジック...
remaining = @change
five_hundred_count = remaining / 500
result += [500] * five_hundred_count
# ...さらに続く条件分岐
```
### After: 委譲によるシンプルな実装
責務を `Change` クラスに委譲したことで、本質的な処理のみが残りました。
```ruby
def refund
  result = @change.clone  # お釣りの状態をコピーして取得
  @change.clear           # 内部状態をリセット
  result
end
```
## 🧠 学び・成長
- **単一責任の原則 (SRP):** クラスが持つべき責任を明確にすることで、修正時の影響範囲を局所化できることを実感しました。
- **カプセル化:** データをただ保持するのではなく、データを操作するロジックとセットにすることで、データの整合性を保つ重要性を学びました。

## 気分・状態
今日の気分: 🙂 (3: 普通)
今日のモチベーション: ⛅ (3: 普通)
目標の進捗: 💤 (1: 全く進まなかった)

---
*Generated by ちいくさ日記*  
*Date: 2026-01-28*  
*Created: 2026-01-29 04:43:54*
