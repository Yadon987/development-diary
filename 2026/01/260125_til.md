# TIL - 2026年01月25日

## 今日のメモ
勉強時間：9時間

卒業制作が無事にMVPリリースを通過しました！ :hugging_face: 
今度はカリキュラムを頑張るぞい :muscle: 
応用STEP　進捗率41％

# 📅 開発日誌 (2026/01/25) - 権限管理の強化とUX改善

## 📝 概要
本日は、アプリケーションの堅牢性を高めるための**権限管理（Authorization）の実装**と、管理画面における**記事投稿体験（UX）の向上**に焦点を当てて開発を行いました。
特にセキュリティ面では `Pundit` を導入し、ロールベースのアクセス制御（RBAC）を確立。管理者（Admin）と編集者（Editor）の責務を明確に分離しました。また、開発中の機能とドキュメントの乖離を防ぐため、READMEの機能ステータスを最新化しました。

---

## 📸 スクリーンショット
[![Image from Gyazo](https://i.gyazo.com/073cdfe19cd879a33475ef0177a8aa63.gif)](https://gyazo.com/073cdfe19cd879a33475ef0177a8aa63)

---

## 🚀 本日の実装ハイライト

### 1. 権限管理システム (RBAC) の構築
**目的**: セキュリティ強化と誤操作防止。
セキュリティポリシーに基づき、リソースごとの詳細なアクセス権限を実装しました。

- **Gem `Pundit` の導入**:
  コントローラーから権限ロジックを切り離し、Policyオブジェクトに集約することで保守性を向上。
  - `ApplicationPolicy` を継承し、デフォルトを「すべて拒否」とするホワイトリスト方式を採用。
  - `Admin::TagPolicy`, `Admin::AuthorPolicy`, `Admin::CategoryPolicy` を実装し、重要リソースへの操作をAdminのみに制限。

- **例外ハンドリングとUX**:
  - 権限不足時に `Pundit::NotAuthorizedError` を捕捉。
  - ユーザーフレンドリーな **403 Forbidden画面** を実装し、単なるエラーではなく「権限がない」旨を明確に伝達。

### 2. コンテンツ管理機能の拡張 (WIP)
**目的**: 記事の表現力向上。
記事詳細画面におけるアイキャッチ画像の表示位置を柔軟に制御できる機能に着手しました。

- **スキーマ変更**:
  - `articles` テーブルにアイキャッチ位置設定オプションを追加。
  - 列挙型を使用し、拡張性のあるデータ構造を採用。
  - 作業ファイル: [app/models/article.rb], [db/migrate/20260125120652_add_eyecatch_options_to_articles.rb]

### 3. ドキュメントの整合性確保
**目的**: 開発ステータスの可視化。
実装済み機能（MVP）と未実装機能のステータスを洗い出し、`README.md` に正確に反映させました。チーム（将来的な）やステークホルダーが現状を即座に把握できる状態を維持しています。

---

## 🛠 技術的なこだわり・工夫

### ✅ セキュアな設計 (Secure by Design)
権限管理において「管理者以外はアクセス不可」とする際、単にリンクを隠すだけでなく、コントローラーレベルで `authorize` メソッドを使用し、URL直接入力による不正アクセスも防ぐ堅牢な設計としました。

### ✅ テスト駆動の意識 (Testing)
権限変更に伴うリグレッションを防ぐため、以下のテストカバレッジを意識しています。
- **Request Spec / System Spec**: 
  - Adminユーザーはアクセス・操作できること。
  - Editorユーザーはアクセス時に403エラー画面へ遷移すること。
  - 期待される挙動をRSpecで保証し、コードの信頼性を担保。

```ruby
# Spec例: 権限のないユーザーのアクセス制御検証
context '一般ユーザー(Editor)がアクセスした場合' do
  it '403 Forbidden画面が表示されること' do
    login_as(editor_user)
    visit admin_tags_path
    expect(page).to have_content '403 Forbidden'
    expect(page).to have_content '権限がありません'
  end
end
```

## 気分・状態
今日の気分: 😁 (5: とても気分が良い)
今日のモチベーション: 🌈 (5: とてもやる気がある)
目標の進捗: 🌳 (5: とてもよく進んだ)

---
*Generated by ちいくさ日記*  
*Date: 2026-01-25*  
*Created: 2026-01-25 21:33:04*
