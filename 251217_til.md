# TIL - 2025年12月17日

## 今日のメモ
勉強時間：12時間

OGP(XなどのSNSでシェアされた際に、タイトル、画像、説明文などを設定・制御するための仕組み)の実装に苦戦中。口で説明するとなんて事のない小さな機能なんだけど、実際に画像を生成させることの難しさよ…

# 📅 開発日誌：2025年12月17日

## 📝 本日の作業概要
本日は、アプリのSNS拡散力を高めるための重要機能である**OGP（Open Graph Protocol）画像の動的生成機能**の実装を完了させました。
開発の過程で、本番環境（Render.com）のインフラ制約による重大な課題に直面しましたが、使用ライブラリの選定を見直し、アーキテクチャを刷新することで解決しました。

## 🛠 技術的な挑戦と解決策

### 1. インフラ制約によるアーキテクチャの転換
*   **直面した課題:**
    当初、HTML/CSSを画像化する `Grover` (Puppeteer) gemを使用していましたが、本番環境へのデプロイ時にメモリ不足や依存関係（Chromium）のエラーが発生し、動作が不安定になりました。
*   **解決策:**
    サーバーリソースへの負荷がより低い **`MiniMagick` (ImageMagick)** を採用する方針へ転換。ベース画像に対してテキストやアバター画像を座標指定で合成する方式へリファクタリングを行いました。
*   **結果:**
    メモリ使用量を大幅に削減し、本番環境でも高速かつ安定して画像を生成できるようになりました。

### 2. 堅牢な設計とバグ修正
*   **Service層への切り出し:**
    画像生成という複雑なロジックを `OgpImageGeneratorService` クラスに分離。コントローラーを薄く保ち（Thin Controller）、再利用性とテスト容易性を高めました。
*   **型安全性の確保:**
    ランキング表示機能において、動的な順位データ（Integer/Symbol）の扱いによる `NoMethodError` が発生しましたが、厳密な型変換処理を追加することで解消しました。

## 🎨 UI/UXへのこだわり
*   **「シェアしたくなる」デザイン:**
    アプリの世界観に合わせ、RPGのステータス画面風のレイアウトを実装。ユーザーのLvや称号を動的に埋め込み、達成感を可視化しました。
*   **動的なレイアウト調整:**
    ユーザー名の長さに応じてフォントサイズを自動計算するロジックを実装し、どんなユーザーデータでもデザインが崩れないように配慮しました。

## 📚 学んだこと
*   **環境差異への意識:** ローカル開発環境（Docker）と本番環境（PaaS）のリソース差を考慮した技術選定の重要性。
*   **デバッグ手法:** 本番環境でのみ発生するエラーに対し、ログを活用して迅速に原因を特定するプロセス。

---

### 📸 スクリーンショット
<img width="1051" height="732" alt="image" src="https://github.com/user-attachments/assets/a8025490-524f-42fd-a6d6-51bd892318a6" />



## 気分・状態
今日の気分: 😁 (5: とても気分が良い)
今日のモチベーション: 🌈 (5: とてもやる気がある)
目標の進捗: 🌳 (5: とてもよく進んだ)

---
*Generated by ちいくさ日記*  
*Date: 2025-12-17*  
*Created: 2025-12-18 06:52:57*
